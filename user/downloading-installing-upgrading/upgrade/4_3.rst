===========================
How to upgrade to Qubes 4.3
===========================

This page explains how to **upgrade from Qubes 4.2 to Qubes 4.3**. There are two ways to upgrade:

* a clean installation
* or an in-place upgrade.

In general, **a clean installation is simpler and less error-prone**, but an in-place upgrade allows you to preserve your customizations.

.. warning:: It is not possible to upgrade directly from releases earlier than 4.2. If you’re still on an earlier release, please either perform a :ref:`clean installation of 4.3 <clean-installation-4.3>` or :doc:`upgrade to 4.2 </user/downloading-installing-upgrading/upgrade/4_2>` first.

First step: do a backup
-----------------------

Before attempting either an in-place upgrade or a clean installation, **we strongly recommend** that you first :doc:`back up your system </user/how-to-guides/how-to-back-up-restore-and-migrate>` so that you don’t lose any data.

You can optionally :ref:`run the updater <user/how-to-guides/how-to-update:Installing updates>` to ensure all of your qubes are in their latest version, **before doing the backup**.

.. _clean-installation-4.3:

Clean installation of Qubes 4.3
-------------------------------

If you would prefer to perform a clean installation rather than upgrading in-place:

1. `Download <https://www.qubes-os.org/downloads/>`__ the latest Qubes 4.3 release.

2. Follow the :doc:`installation guide </user/downloading-installing-upgrading/installation-guide>` to install Qubes 4.3.

3. :ref:`Restore from your backup <user/how-to-guides/how-to-back-up-restore-and-migrate:restoring from a backup>` on your new 4.3 installation.

4. *(optional)* **If you restored templates from previous Qubes versions** (i.e.: Qubes 4.2), during the previous step, you need to follow some extra instructions:

   .. _upgrade-templates-4.3:

   1. :ref:`Install in dom0 <install-package-in-dom0>` the :program:`qubes-dist-upgrade` tool, in order to be able to upgrade the templates to the Qubes 4.3 version:

      .. code:: console

         [user@dom0] $ sudo qubes-dom0-update qubes-dist-upgrade

   2. Change your templates to use the 4.3 repositories instead of the 4.2 ones. You do this with the following command in the dom0 terminal:

      .. code:: console

          [user@dom0] $ sudo qubes-dist-upgrade --releasever=4.3 --template-standalone-upgrade

      .. warning:: This step is critical to ensure the templates will receive updates once Qubes 4.2 reaches end-of-life (EOL).

5. When this completes, you can start using Qubes OS 4.3.

In-place upgrade from Qubes 4.2 to Qubes 4.3
--------------------------------------------

The upgrade **may take several hours**, and **will download several gigabytes of data**.

.. note::

   When trying to upgrade to a release candidate, remember to **permanently** enable the :ref:`qubes-dom0-current-testing repository <dom0-testing-repositories>`.

How-to upgrade from Qubes 4.2 to Qubes 4.3 in-place
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

1. You have to :ref:`install qubes-dist-upgrade in dom0 <install-package-in-dom0>`:

    .. code:: console

         [user@dom0] $ sudo qubes-dom0-update qubes-dist-upgrade

2.  After installing the tool, pre-reboot stages can be performed at once with:

    .. code:: console

         [user@dom0] $ sudo qubes-dist-upgrade --releasever 4.3 --all-pre-reboot

    Optionally, an ``--assumeyes`` (or ``-y``) option can be used to automatically accept all the actions without confirmation.

    Alternatively, each upgrade stage can be started separately (see the list of options above).

3. After completing “STAGE 1” through “STAGE 3”, restart the system.

4. Then perform the final steps:

    .. code:: console

          [user@dom0] $ sudo qubes-dist-upgrade --releasever 4.3 --all-post-reboot

5. After performing those steps, it’s recommended to restart the system one last time.

6. When this completes, you can start using Qubes OS 4.3.

Description of the upgrade process
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

**In-place upgrade is a complex operation.** For this reason, we provide a :program:`qubes-dist-upgrade` tool to handle all the necessary steps automatically. You have to :ref:`install it in dom0 <install-package-in-dom0>`.

The upgrade consists of **six stages** available in two phase:

1. **three before restarting the system** (option: ``--all-pre-reboot``), **stage 1 to 3**:
    1. Update of dom0, TemplatesVM and StandaloneVM. (option: ``--update,``)
    2. Update 'qubes-release' for Qubes R4.3. (option: ``--release-upgrade,``)
    3. Upgrade to Qubes R4.3 and Fedora 41 repositories. (option: ``--dist-upgrade,``)

2. and **three after restarting the system** (option: ``--all-post-reboot``), **stage 4 to 6**:

    4. Upgrade templates and standalone VMs to R4.3 repository. (option: ``--template-standalone-upgrade,``)
    5. Finalize upgrade (option: ``--finalize,``). It does:

        - resync applications and features
        - create LVM devices cache
        - update PCI device IDs
        - enable minimal-netvm / minimal-usbvm services
        - cleanup salt states
        - enable preloaded disposables if system has more than 16GB memory

    6. Check if all templates are supported (option: ``--check-supported-template``)

Full list of options can be obtained with ``qubes-dist-upgrade --releasever 4.3 --help``.

Last step: update your system
-----------------------------

After upgrading or performing a clean installation, we strongly recommend :doc:`updating your system </user/how-to-guides/how-to-update>`.
